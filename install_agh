  GNU nano 7.2                               /home/user/projekt/install_agh.yml
---
- name: Instalacja AdGuard Home - Krzysztof Szywacz
  hosts: agh
  become: yes
  tasks:
    - name: 1. Instalacja LVM2
      apt:
        name: lvm2
        state: present
        update_cache: yes

    - name: 2. Utworzenie grupy woluminow (RAID Mirror)
      community.general.lvg:
        vg: adg_vg
        pvs: /dev/sdb,/dev/sdc

    - name: 3. Utworzenie woluminu logicznego
      community.general.lvol:
        vg: adg_vg
        lv: adg_lv
        size: 100%FREE
        opts: "--type raid1"
      ignore_errors: yes

    - name: 4. Formatowanie dysku (ext4)
      filesystem:
 fstype: ext4
        dev: /dev/adg_vg/adg_lv

    - name: 5. Utworzenie katalogu /adguardhome
      file:
        path: /adguardhome
        state: directory

    - name: 6. Montowanie dysku
      mount:
        path: /adguardhome
        src: /dev/adg_vg/adg_lv
        fstype: ext4
        state: mounted

    - name: 7. Instalacja AdGuard Home (Skrypt)
      shell: |
        curl -s -S -L https://raw.githubusercontent.com/AdguardTeam/AdGuardHome/master/scripts/install.sh | sh -s -- -v>
      args:
        creates: /adguardhome/AdGuardHome/AdGuardHome

    - name: 8. Konfiguracja Firewalla (Metoda Shell)
      shell: |
        ufw allow OpenSSH
        ufw allow 53
        ufw allow 80/tcp
        ufw allow 3000/tcp
        ufw --force enable
